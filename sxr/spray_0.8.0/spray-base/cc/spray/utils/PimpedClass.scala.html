<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cc/spray/utils/PimpedClass.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2011 Mathias Doenitz
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> cc.spray.utils

<span class="keyword">import</span> java.lang.reflect.<span class="delimiter">{</span>GenericArrayType, ParameterizedType, Type, Array =&gt; RArray<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class PimpedClass[A] extends java.lang.Object with ScalaObject" id="10014">PimpedClass</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10015">A</a><span class="delimiter">]</span><a href="#10014" title="ScalaObject" class="delimiter">(</a><a title="Class[A]" id="94352">underlying</a>: <span title="Class[A]">Class</span><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  
  <span class="comment">/**
  * Get the actual type arguments used to extend the given generic base class or interface.
  * (Based on code copyright 2007 by Ian Robertson)
  *
  * @param base the generic base class or interface
  * @return a list of the raw classes for the actual type arguments.
  */</span>
  <span class="keyword">def</span> <a title="(base: Class[_])List[Option[Class[_]]]" id="13162">getTypeArgumentsOf</a><span class="delimiter">(</span><a title="Class[_]" id="94353">base</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[Option[Class[_]]]">List</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    
    <span class="comment">// Get the underlying class for t, or None if t is a variable type.</span>
    <span class="keyword">def</span> <a title="(t: java.lang.reflect.Type)Option[Class[_]]" id="94362">getClass</a><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="94365">t</a>: <span title="java.lang.reflect.Type">Type</span><span class="delimiter">)</span>: <span title="Option[Class[_]]">Option</span><span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#94365" title="java.lang.reflect.Type">t</a> <span title="Option[Class[_]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Some[Class[_]]" id="94370">x</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <span title="(x: Class[_])Some[Class[_]]">Some</span><span class="delimiter">(</span><a href="#94370" title="Class[_]">x</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Option[Class[_]]" id="94378">x</a>: <span title="java.lang.reflect.ParameterizedType">ParameterizedType</span> =&gt; <a href="#94362" title="(t: java.lang.reflect.Type)Option[Class[_]]">getClass</a><span class="delimiter">(</span><a href="#94378" title="java.lang.reflect.ParameterizedType">x</a>.<span title="()java.lang.reflect.Type">getRawType</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Option[java.lang.Class[_ &lt;: java.lang.Object]]" id="94384">x</a>: <span title="java.lang.reflect.GenericArrayType">GenericArrayType</span> =&gt; <a href="#94362" title="(t: java.lang.reflect.Type)Option[Class[_]]">getClass</a><span class="delimiter">(</span><a href="#94384" title="java.lang.reflect.GenericArrayType">x</a>.<span title="()java.lang.reflect.Type">getGenericComponentType</span><span class="delimiter">)</span>.<span title="(f: Class[_] =&gt; java.lang.Class[_ &lt;: java.lang.Object])Option[java.lang.Class[_ &lt;: java.lang.Object]]">map</span><span class="delimiter">(</span><a title="Class[_]" id="94390">c</a> =&gt; <span title="object java.lang.reflect.Array">RArray</span>.<span title="(x$1: java.lang.Class[_], x$2: Int)java.lang.Object">newInstance</span><span class="delimiter">(</span><a href="#94390" title="Class[_]">c</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="()java.lang.Class[_]">getClass</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
    <span class="delimiter">}</span>
    
    <span class="comment">// the Type parameters for t along with a map of type parameters to type arguments</span>
    <span class="keyword">def</span> <a title="(t: java.lang.reflect.Type)Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]" id="94363">typeArguments</a><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="94505">t</a>: <span title="java.lang.reflect.Type">Type</span><span class="delimiter">)</span>: <span title="Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>List<span class="delimiter">[</span>Type<span class="delimiter">]</span>, Map<span class="delimiter">[</span>Type, Type<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span> = <a href="#94505" title="java.lang.reflect.Type">t</a> <span title="Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]" id="94506">x</a> <span class="keyword">if</span> <a href="#94362" title="(t: java.lang.reflect.Type)Option[Class[_]]">getClass</a><span class="delimiter">(</span><a href="#94506" title="java.lang.reflect.Type">x</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="(x: Class[_$1])Some[Class[_$1]]">Some</span><span class="delimiter">(</span><a href="#94353" title="Class[_]">base</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// terminate recursion</span>
        <a href="#94506" title="java.lang.reflect.Type">x</a> <span title="Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Some[(List[java.lang.reflect.TypeVariable[java.lang.Class[_]]], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])]" id="94516">x</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <span title="(x: (List[java.lang.reflect.TypeVariable[java.lang.Class[_]]], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type]))Some[(List[java.lang.reflect.TypeVariable[java.lang.Class[_]]], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])]">Some</span><span class="delimiter">(</span><span title="(_1: List[java.lang.reflect.TypeVariable[java.lang.Class[_]]], _2: scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])(List[java.lang.reflect.TypeVariable[java.lang.Class[_]]], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])" class="delimiter">(</span><a href="#94516" title="Class[_]">x</a>.<span title="(xs: Array[java.lang.reflect.TypeVariable[java.lang.Class[_]]])scala.collection.mutable.ArrayOps[java.lang.reflect.TypeVariable[java.lang.Class[_]]]">getTypeParameters</span>.<span title="=&gt; List[java.lang.reflect.TypeVariable[java.lang.Class[_]]]">toList</span>, <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="[A, B]=&gt; scala.collection.immutable.Map[A,B]">empty</span><span title="scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type]" class="delimiter">[</span><span title="java.lang.reflect.Type">Type</span>, <span title="java.lang.reflect.Type">Type</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Some[(List[java.lang.reflect.Type], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])]" id="94667">p</a>: <span title="java.lang.reflect.ParameterizedType">ParameterizedType</span> =&gt; <span title="(x: (List[java.lang.reflect.Type], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type]))Some[(List[java.lang.reflect.Type], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])]">Some</span><span class="delimiter">(</span>
            <span title="(_1: List[java.lang.reflect.Type], _2: scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])(List[java.lang.reflect.Type], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])" class="delimiter">(</span><a href="#94667" title="java.lang.reflect.ParameterizedType">p</a>.<span title="(xs: Array[java.lang.reflect.Type])scala.collection.mutable.ArrayOps[java.lang.reflect.Type]">getActualTypeArguments</span>.<span title="=&gt; List[java.lang.reflect.Type]">toList</span>,
                    <a href="#94667" title="java.lang.reflect.ParameterizedType">p</a>.<span title="()java.lang.reflect.Type">getRawType</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[_$4]" class="delimiter">[</span><span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="(xs: Array[java.lang.reflect.TypeVariable[java.lang.Class[_$4]]])scala.collection.mutable.ArrayOps[java.lang.reflect.TypeVariable[java.lang.Class[_$4]]]">getTypeParameters</span>.<span title="(that: scala.collection.GenIterable[java.lang.reflect.Type])(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.reflect.TypeVariable[java.lang.Class[_$4]]],(java.lang.reflect.TypeVariable[java.lang.Class[_$4]], java.lang.reflect.Type),Array[(java.lang.reflect.TypeVariable[java.lang.Class[_$4]], java.lang.reflect.Type)]])Array[(java.lang.reflect.TypeVariable[java.lang.Class[_$4]], java.lang.reflect.Type)]">zip</span><span title="(xs: Array[(java.lang.reflect.TypeVariable[java.lang.Class[_$4]], java.lang.reflect.Type)])scala.collection.mutable.ArrayOps[(java.lang.reflect.TypeVariable[java.lang.Class[_$4]], java.lang.reflect.Type)]" class="delimiter">(</span><a href="#94667" title="java.lang.reflect.ParameterizedType">p</a>.<span title="(xs: Array[java.lang.reflect.Type])scala.collection.mutable.WrappedArray[java.lang.reflect.Type]">getActualTypeArguments</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[(java.lang.reflect.TypeVariable[java.lang.Class[_$4]], java.lang.reflect.Type),(java.lang.reflect.Type, java.lang.reflect.Type)])scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type]">toMap</span><span class="delimiter">)</span>
          <span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]" id="95968">x</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[java.lang.reflect.Type]" id="95970">supers</a> = <span title="(x: java.lang.reflect.Type)Option[java.lang.reflect.Type]">Option</span><span class="delimiter">(</span><a href="#95968" title="Class[_]">x</a>.<span title="()java.lang.reflect.Type">getGenericSuperclass</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.reflect.Type]">toList</span> <a href="#95971" title="(prefix: List[java.lang.reflect.Type])List[java.lang.reflect.Type]">:::</a> <a href="#95968" title="Class[_]">x</a>.<span title="(xs: Array[java.lang.reflect.Type])scala.collection.mutable.ArrayOps[java.lang.reflect.Type]">getGenericInterfaces</span>.<span title="=&gt; List[java.lang.reflect.Type]">toList</span>
        <a href="package.scala.html#10097" title="(seq: scala.collection.immutable.LinearSeq[java.lang.reflect.Type])cc.spray.utils.PimpedLinearSeq[java.lang.reflect.Type]">supers</a>.<a href="PimpedLinearSeq.scala.html#13183" title="(f: java.lang.reflect.Type =&gt; Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])])Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]">mapFind</a><span class="delimiter">(</span><a href="#94363" title="(t: java.lang.reflect.Type)Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]">typeArguments</a><span class="delimiter">(</span><a href="#96131" title="java.lang.reflect.Type">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]" id="96133">p</a>: <span title="java.lang.reflect.ParameterizedType">ParameterizedType</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.lang.Class[_]" id="96134">clazz</a> = <a href="#96133" title="java.lang.reflect.ParameterizedType">p</a>.<span title="()java.lang.reflect.Type">getRawType</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[_$5]" class="delimiter">[</span><span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span>
        <a href="#94363" title="(t: java.lang.reflect.Type)Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]">typeArguments</a><span class="delimiter">(</span><a href="#96134" title="java.lang.Class[_]">clazz</a><span class="delimiter">)</span>.<span title="(f: (List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type]) =&gt; (List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type]))Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]">map</span> <a href="#96146" title="(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])" class="delimiter">{</a> <span class="keyword">case</span> <span title="(List[java.lang.reflect.Type], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])" class="delimiter">(</span><a title="List[java.lang.reflect.Type]" id="96149">actualTypeArguments</a>, <a title="Map[java.lang.reflect.Type,java.lang.reflect.Type]" id="96150">params2args</a><span class="delimiter">)</span> =&gt;
          <span title="(_1: List[java.lang.reflect.Type], _2: scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])(List[java.lang.reflect.Type], scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type])" class="delimiter">(</span><a href="#96149" title="List[java.lang.reflect.Type]">actualTypeArguments</a>, <a href="#96150" title="Map[java.lang.reflect.Type,java.lang.reflect.Type]">params2args</a> <span title="(xs: scala.collection.GenTraversableOnce[(java.lang.reflect.Type, java.lang.reflect.Type)])scala.collection.immutable.Map[java.lang.reflect.Type,java.lang.reflect.Type]">++</span> <a href="#96134" title="java.lang.Class[_]">clazz</a>.<span title="(xs: Array[java.lang.reflect.TypeVariable[java.lang.Class[_$5]]])scala.collection.mutable.ArrayOps[java.lang.reflect.TypeVariable[java.lang.Class[_$5]]]">getTypeParameters</span>.<span title="(that: scala.collection.GenIterable[java.lang.reflect.Type])(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.reflect.TypeVariable[java.lang.Class[_$5]]],(java.lang.reflect.TypeVariable[java.lang.Class[_$5]], java.lang.reflect.Type),Array[(java.lang.reflect.TypeVariable[java.lang.Class[_$5]], java.lang.reflect.Type)]])Array[(java.lang.reflect.TypeVariable[java.lang.Class[_$5]], java.lang.reflect.Type)]">zip</span><span title="(xs: Array[(java.lang.reflect.TypeVariable[java.lang.Class[_$5]], java.lang.reflect.Type)])scala.collection.mutable.ArrayOps[(java.lang.reflect.TypeVariable[java.lang.Class[_$5]], java.lang.reflect.Type)]" class="delimiter">(</span><a href="#96133" title="java.lang.reflect.ParameterizedType">p</a>.<span title="(xs: Array[java.lang.reflect.Type])scala.collection.mutable.WrappedArray[java.lang.reflect.Type]">getActualTypeArguments</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(t: java.lang.reflect.Type, params2args: Map[java.lang.reflect.Type,java.lang.reflect.Type])java.lang.reflect.Type" id="94364">resolve</a><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="97431">t</a>: <span title="java.lang.reflect.Type">Type</span>, <a title="Map[java.lang.reflect.Type,java.lang.reflect.Type]" id="97432">params2args</a>: <span title="Map[java.lang.reflect.Type,java.lang.reflect.Type]">Map</span><span class="delimiter">[</span>Type, Type<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="java.lang.reflect.Type">Type</span> = <a href="#97432" title="Map[java.lang.reflect.Type,java.lang.reflect.Type]">params2args</a>.<span title="(key: java.lang.reflect.Type)Option[java.lang.reflect.Type]">get</span><span class="delimiter">(</span><a href="#97431" title="java.lang.reflect.Type">t</a><span class="delimiter">)</span> <span title="java.lang.reflect.Type" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.lang.reflect.Type">Some</span><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="97436">x</a><span class="delimiter">)</span> =&gt; <a href="#94364" title="(t: java.lang.reflect.Type, params2args: Map[java.lang.reflect.Type,java.lang.reflect.Type])java.lang.reflect.Type">resolve</a><span class="delimiter">(</span><a href="#97436" title="java.lang.reflect.Type">x</a>, <a href="#97432" title="Map[java.lang.reflect.Type,java.lang.reflect.Type]">params2args</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.lang.reflect.Type">None</span> =&gt; <a href="#97431" title="java.lang.reflect.Type">t</a>
    <span class="delimiter">}</span>
    
    <a href="#94363" title="(t: java.lang.reflect.Type)Option[(List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type])]">typeArguments</a><span class="delimiter">(</span><a href="#94352" title="Class[A]">underlying</a><span class="delimiter">)</span>.<span title="(f: (List[java.lang.reflect.Type], Map[java.lang.reflect.Type,java.lang.reflect.Type]) =&gt; List[Option[Class[_]]])Option[List[Option[Class[_]]]]">map</span> <a href="#97440" title="List[Option[Class[_]]]" class="delimiter">{</a> <span class="keyword">case</span> <span title="List[Option[Class[_]]]" class="delimiter">(</span><a title="List[java.lang.reflect.Type]" id="97443">typeArgs</a>, <a title="Map[java.lang.reflect.Type,java.lang.reflect.Type]" id="97444">params2args</a><span class="delimiter">)</span> =&gt;
      <a href="#97443" title="List[java.lang.reflect.Type]">typeArgs</a>.<span title="(f: java.lang.reflect.Type =&gt; Option[Class[_]])(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.reflect.Type],Option[Class[_]],List[Option[Class[_]]]])List[Option[Class[_]]]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Option[Class[_]],List[Option[Class[_]]]]" class="delimiter">{</span> <a title="java.lang.reflect.Type" id="97461">baseType</a> =&gt; <a href="#94362" title="(t: java.lang.reflect.Type)Option[Class[_]]">getClass</a><span class="delimiter">(</span><a href="#94364" title="(t: java.lang.reflect.Type, params2args: Map[java.lang.reflect.Type,java.lang.reflect.Type])java.lang.reflect.Type">resolve</a><span class="delimiter">(</span><a href="#97461" title="java.lang.reflect.Type">baseType</a>, <a href="#97444" title="Map[java.lang.reflect.Type,java.lang.reflect.Type]">params2args</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="(default: =&gt; List[Option[Class[_]]])List[Option[Class[_]]]">getOrElse</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
<span class="delimiter">}</span>
        </pre>
    </body>
</html>