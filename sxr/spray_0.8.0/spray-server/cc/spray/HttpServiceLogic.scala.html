<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>cc/spray/HttpServiceLogic.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright (C) 2011 Mathias Doenitz
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> cc.spray

<span class="keyword">import</span> http._
<span class="keyword">import</span> <span title="object cc.spray.http.StatusCodes">StatusCodes</span>._
<span class="keyword">import</span> <span title="object cc.spray.http.HttpHeaders">HttpHeaders</span>._
<span class="keyword">import</span> utils.<span class="delimiter">{</span>Logging, IllegalResponseException<span class="delimiter">}</span>

<span class="comment">/**
 * The logic part of the [[cc.spray.HttpService]]. Contains the code for [[cc.spray.RequestContext]] creation as well
 * as translation of [[cc.spray.Rejection]]s and Exceptions to [[cc.spray.http.HttpResponse]]s. 
 */</span>
<span class="keyword">trait</span> <a title="trait HttpServiceLogic extends java.lang.Object with cc.spray.ErrorHandling with ScalaObject" id="9536">HttpServiceLogic</a> <span title="ScalaObject" class="keyword">extends</span> <a href="ErrorHandling.scala.html#9503" title="cc.spray.ErrorHandling">ErrorHandling</a> <span class="delimiter">{</span>
  <span class="keyword">this</span>: Logging =&gt;
  
  <span class="comment">/**
   * The route of this HttpService
   */</span>
  <span class="keyword">def</span> <a title="=&gt; cc.spray.RequestContext =&gt; Unit" id="27289">route</a>: <span title="cc.spray.RequestContext =&gt; Unit">Route</span>

  <span class="comment">/**
   * A custom handler function for rejections.
   * All rejections not handled by this PartialFunction will be responded to with the default logic.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; PartialFunction[List[cc.spray.Rejection],cc.spray.http.HttpResponse]" id="27290">customRejectionHandler</a>: <span title="PartialFunction[List[cc.spray.Rejection],cc.spray.http.HttpResponse]">PartialFunction</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Rejection<span class="delimiter">]</span>, HttpResponse<span class="delimiter">]</span>
  
  <span class="keyword">def</span> <a title="(context: cc.spray.RequestContext)Unit" id="27291">handle</a><span class="delimiter">(</span><a title="cc.spray.RequestContext" id="27460">context</a>: <a href="RequestContext.scala.html#9602" title="cc.spray.RequestContext">RequestContext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#27289" title="(v1: cc.spray.RequestContext)Unit">route</a><span class="delimiter">(</span><a href="#27460" title="cc.spray.RequestContext">context</a>.<a href="RequestContext.scala.html#23753" title="(f: cc.spray.RoutingResult =&gt; cc.spray.RoutingResult)cc.spray.RequestContext">withRoutingResultTransformed</a><span class="delimiter">(</span><a href="#27292" title="(rr: cc.spray.RoutingResult)cc.spray.RoutingResult">convertRejections</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="27500">e</a>: <span title="Exception">Exception</span> =&gt; <a href="#27460" title="cc.spray.RequestContext">context</a>.<a href="RequestContext.scala.html#23769" title="(response: cc.spray.http.HttpResponse)Unit">complete</a><span class="delimiter">(</span><a href="ErrorHandling.scala.html#14325" title="(request: Any, e: Exception)cc.spray.http.HttpResponse">responseForException</a><span class="delimiter">(</span><a href="#27460" title="cc.spray.RequestContext">context</a>.<a href="RequestContext.scala.html#23742" title="=&gt; cc.spray.http.HttpRequest">request</a>, <a href="#27500" title="Exception">e</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">protected</span><span class="delimiter">[</span>spray<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(rr: cc.spray.RoutingResult)cc.spray.RoutingResult" id="27292">convertRejections</a><span class="delimiter">(</span><a title="cc.spray.RoutingResult" id="27496">rr</a>: <a href="RoutingResult.scala.html#9621" title="cc.spray.RoutingResult">RoutingResult</a><span class="delimiter">)</span>: <a href="RoutingResult.scala.html#9621" title="cc.spray.RoutingResult">RoutingResult</a> = <a href="#27496" title="cc.spray.RoutingResult">rr</a> <span title="cc.spray.RoutingResult" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="cc.spray.Respond" id="28326">x</a>: <a href="RoutingResult.scala.html#9622" title="cc.spray.Respond">Respond</a> =&gt; <a href="#27294" title="(response: cc.spray.http.HttpResponse)(f: cc.spray.http.HttpResponse =&gt; cc.spray.Respond)cc.spray.Respond">withVerifiedResponse</a><span class="delimiter">(</span><a href="#28326" title="cc.spray.Respond">x</a>.<a href="RoutingResult.scala.html#28328" title="=&gt; cc.spray.http.HttpResponse">response</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="cc.spray.http.HttpResponse" id="28341">_</a> =&gt; <a href="#28326" title="cc.spray.Respond">x</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="cc.spray.RoutingResult">Reject</span><span class="delimiter">(</span><a title="Set[cc.spray.Rejection]" id="28732">rejections</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Set[cc.spray.Rejection]" id="28733">activeRejections</a> = <a href="Rejection.scala.html#9591" title="object cc.spray.Rejections">Rejections</a>.<a href="Rejection.scala.html#28735" title="(rejections: Set[cc.spray.Rejection])Set[cc.spray.Rejection]">applyCancellations</a><span class="delimiter">(</span><a href="#28732" title="Set[cc.spray.Rejection]">rejections</a><span class="delimiter">)</span>
      <span title="cc.spray.RoutingResult" class="keyword">if</span> <span class="delimiter">(</span><a href="#28733" title="Set[cc.spray.Rejection]">activeRejections</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="RoutingResult.scala.html#28346" title="(rejections: Set[cc.spray.Rejection])cc.spray.Reject">Reject</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// reject to RootService to signal that no response from this service</span>
      <span class="keyword">else</span>
        <a href="#27294" title="(response: cc.spray.http.HttpResponse)(f: cc.spray.http.HttpResponse =&gt; cc.spray.Respond)cc.spray.Respond">withVerifiedResponse</a><span class="delimiter">(</span><a href="#27293" title="(rejections: List[cc.spray.Rejection])cc.spray.http.HttpResponse">responseForRejections</a><span class="delimiter">(</span><a href="#28733" title="Set[cc.spray.Rejection]">activeRejections</a>.<span title="=&gt; List[cc.spray.Rejection]">toList</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="RoutingResult.scala.html#28771" title="(response: cc.spray.http.HttpResponse)cc.spray.Respond">Respond</a><span class="delimiter">(</span><a href="#28768" title="cc.spray.http.HttpResponse">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">protected</span><span class="delimiter">[</span>spray<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(rejections: List[cc.spray.Rejection])cc.spray.http.HttpResponse" id="27293">responseForRejections</a><span class="delimiter">(</span><a title="List[cc.spray.Rejection]" id="28764">rejections</a>: <span title="List[cc.spray.Rejection]">List</span><span class="delimiter">[</span>Rejection<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="cc.spray.http.HttpResponse">HttpResponse</span> = <span class="delimiter">{</span>
    <span title="cc.spray.http.HttpResponse" class="keyword">if</span> <span class="delimiter">(</span><a href="#27290" title="=&gt; PartialFunction[List[cc.spray.Rejection],cc.spray.http.HttpResponse]">customRejectionHandler</a>.<span title="(x: List[cc.spray.Rejection])Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#28764" title="List[cc.spray.Rejection]">rejections</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#27290" title="(v1: List[cc.spray.Rejection])cc.spray.http.HttpResponse">customRejectionHandler</a><span class="delimiter">(</span><a href="#28764" title="List[cc.spray.Rejection]">rejections</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#28764" title="List[cc.spray.Rejection]">rejections</a> <span title="cc.spray.http.HttpResponse" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">AuthenticationRequiredRejection</span><span class="delimiter">(</span><a title="String" id="28901">scheme</a>, <a title="String" id="28902">realm</a>, <a title="Map[String,String]" id="28903">params</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, headers: List[cc.spray.http.HttpHeader], content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">Unauthorized</span>, <span title="(first: cc.spray.http.HttpChallenge, more: cc.spray.http.HttpChallenge*)cc.spray.http.HttpHeaders.WWW-Authenticate">`WWW-Authenticate`</span><span class="delimiter">(</span><span title="(scheme: String, realm: String, params: Map[String,String])cc.spray.http.HttpChallenge">HttpChallenge</span><span class="delimiter">(</span><a href="#28901" title="String">scheme</a>, <a href="#28902" title="String">realm</a>, <a href="#28903" title="Map[String,String]">params</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#28912" title="(x: cc.spray.http.HttpHeaders.WWW-Authenticate)List[cc.spray.http.HttpHeaders.WWW-Authenticate]">::</a> <span title="object Nil">Nil</span>, <span title="java.lang.String(&quot;The resource requires authentication, which was not supplied with the request&quot;)" class="string">&quot;The resource requires authentication, which was not supplied with the request&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">AuthenticationFailedRejection</span><span class="delimiter">(</span><a title="String" id="29035">realm</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">Forbidden</span>, <span title="java.lang.String(&quot;The supplied authentication is either invalid or not authorized to access this resource&quot;)" class="string">&quot;The supplied authentication is either invalid or not authorized to access this resource&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="Rejection.scala.html#9583" title="cc.spray.http.HttpResponse">AuthorizationFailedRejection</a> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">Forbidden</span>, <span title="java.lang.String(&quot;The supplied authentication is either invalid or not authorized to access this resource&quot;)" class="string">&quot;The supplied authentication is either invalid or not authorized to access this resource&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">CorruptRequestEncodingRejection</span><span class="delimiter">(</span><a title="String" id="29088">msg</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;The requests encoding is corrupt:\012&quot;)" class="string">&quot;The requests encoding is corrupt:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29088" title="String">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">MalformedFormFieldRejection</span><span class="delimiter">(</span><a title="String" id="29153">msg</a>, <a title="String" id="29154">name</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;The form field \'&quot;)" class="string">&quot;The form field '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29154" title="String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' was malformed:\012&quot;)" class="string">&quot;' was malformed:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29153" title="String">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">MalformedQueryParamRejection</span><span class="delimiter">(</span><a title="String" id="29204">msg</a>, <a title="String" id="29205">name</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;The query parameter \'&quot;)" class="string">&quot;The query parameter '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29205" title="String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' was malformed:\012&quot;)" class="string">&quot;' was malformed:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29204" title="String">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">MalformedRequestContentRejection</span><span class="delimiter">(</span><a title="String" id="29245">msg</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;The request content was malformed:\012&quot;)" class="string">&quot;The request content was malformed:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29245" title="String">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse" class="delimiter">(</span>_: <a href="Rejection.scala.html#9542" title="cc.spray.MethodRejection">MethodRejection</a><span class="delimiter">)</span> :: _ =&gt;
        <span class="comment">// TODO: add Allow header (required by the spec)</span>
        <span class="keyword">val</span> <a title="List[cc.spray.http.HttpMethod]" id="29263">methods</a> = <a href="#28764" title="List[cc.spray.Rejection]">rejections</a>.<span title="(pf: PartialFunction[cc.spray.Rejection,cc.spray.http.HttpMethod])(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.Rejection],cc.spray.http.HttpMethod,List[cc.spray.http.HttpMethod]])List[cc.spray.http.HttpMethod]">collect</span> <a href="#29276" title="cc.spray.http.HttpMethod" class="delimiter">{</a> <span class="keyword">case</span> <span title="cc.spray.http.HttpMethod">MethodRejection</span><span class="delimiter">(</span><a title="cc.spray.http.HttpMethod" id="29304">method</a><span class="delimiter">)</span> =&gt; <a href="#29304" title="cc.spray.http.HttpMethod">method</a> <span class="delimiter">}</span>
        <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">MethodNotAllowed</span>, <span title="java.lang.String(&quot;HTTP method not allowed, supported methods: &quot;)" class="string">&quot;HTTP method not allowed, supported methods: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29263" title="List[cc.spray.http.HttpMethod]">methods</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">MissingFormFieldRejection</span><span class="delimiter">(</span><a title="String" id="31507">fieldName</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;Request is missing required form field \'&quot;)" class="string">&quot;Request is missing required form field '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#31507" title="String">fieldName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="Char(\'\\\'\')" class="char">'\''</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">MissingQueryParamRejection</span><span class="delimiter">(</span><a title="String" id="31547">paramName</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">NotFound</span>, <span title="java.lang.String(&quot;Request is missing required query parameter \'&quot;)" class="string">&quot;Request is missing required query parameter '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#31547" title="String">paramName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="Char(\'\\\'\')" class="char">'\''</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="Rejection.scala.html#9569" title="cc.spray.http.HttpResponse">RequestEntityExpectedRejection</a> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;Request entity expected but not supplied&quot;)" class="string">&quot;Request entity expected but not supplied&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse" class="delimiter">(</span>_: <a href="Rejection.scala.html#9571" title="cc.spray.UnacceptedResponseContentTypeRejection">UnacceptedResponseContentTypeRejection</a><span class="delimiter">)</span> :: _ =&gt;
        <span class="keyword">val</span> <a title="List[cc.spray.http.ContentType]" id="31578">supported</a> = <a href="#28764" title="List[cc.spray.Rejection]">rejections</a>.<span title="(f: cc.spray.Rejection =&gt; scala.collection.GenTraversableOnce[cc.spray.http.ContentType])(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.Rejection],cc.spray.http.ContentType,List[cc.spray.http.ContentType]])List[cc.spray.http.ContentType]">flatMap</span> <a href="#31595" title="Seq[cc.spray.http.ContentType]" class="delimiter">{</a> <span class="keyword">case</span> <span title="Seq[cc.spray.http.ContentType]">UnacceptedResponseContentTypeRejection</span><span class="delimiter">(</span><a title="Seq[cc.spray.http.ContentType]" id="31666">supported</a><span class="delimiter">)</span> =&gt; <a href="#31666" title="Seq[cc.spray.http.ContentType]">supported</a> <span class="delimiter">}</span>
        <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">NotAcceptable</span>, <span title="java.lang.String(&quot;Resource representation is only available with these Content-Types:\012&quot;)" class="string">&quot;Resource representation is only available with these Content-Types:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#31578" title="List[cc.spray.http.ContentType]">supported</a>.<span title="(f: cc.spray.http.ContentType =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.http.ContentType],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#31718" title="cc.spray.http.ContentType">_</a>.<span title="=&gt; String">value</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse" class="delimiter">(</span>_: <a href="Rejection.scala.html#9574" title="cc.spray.UnacceptedResponseEncodingRejection">UnacceptedResponseEncodingRejection</a><span class="delimiter">)</span> :: _ =&gt;
        <span class="keyword">val</span> <a title="List[cc.spray.http.HttpEncoding]" id="31774">supported</a> = <a href="#28764" title="List[cc.spray.Rejection]">rejections</a>.<span title="(pf: PartialFunction[cc.spray.Rejection,cc.spray.http.HttpEncoding])(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.Rejection],cc.spray.http.HttpEncoding,List[cc.spray.http.HttpEncoding]])List[cc.spray.http.HttpEncoding]">collect</span> <a href="#31783" title="cc.spray.http.HttpEncoding" class="delimiter">{</a> <span class="keyword">case</span> <span title="cc.spray.http.HttpEncoding">UnacceptedResponseEncodingRejection</span><span class="delimiter">(</span><a title="cc.spray.http.HttpEncoding" id="31849">supported</a><span class="delimiter">)</span> =&gt; <a href="#31849" title="cc.spray.http.HttpEncoding">supported</a> <span class="delimiter">}</span>
        <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">NotAcceptable</span>, <span title="java.lang.String(&quot;Resource representation is only available with these Content-Encodings:\012&quot;)" class="string">&quot;Resource representation is only available with these Content-Encodings:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#31774" title="List[cc.spray.http.HttpEncoding]">supported</a>.<span title="(f: cc.spray.http.HttpEncoding =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.http.HttpEncoding],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#31901" title="cc.spray.http.HttpEncoding">_</a>.<span title="=&gt; String">value</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse" class="delimiter">(</span>_: <a href="Rejection.scala.html#9557" title="cc.spray.UnsupportedRequestContentTypeRejection">UnsupportedRequestContentTypeRejection</a><span class="delimiter">)</span> :: _ =&gt;
        <span class="keyword">val</span> <a title="List[String]" id="31941">supported</a> = <a href="#28764" title="List[cc.spray.Rejection]">rejections</a>.<span title="(pf: PartialFunction[cc.spray.Rejection,String])(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.Rejection],String,List[String]])List[String]">collect</span> <a href="#31950" title="String" class="delimiter">{</a> <span class="keyword">case</span> <span title="String">UnsupportedRequestContentTypeRejection</span><span class="delimiter">(</span><a title="String" id="31973">supported</a><span class="delimiter">)</span> =&gt; <a href="#31973" title="String">supported</a> <span class="delimiter">}</span>
        <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">UnsupportedMediaType</span>, <span title="java.lang.String(&quot;There was a problem with the requests Content-Type:\012&quot;)" class="string">&quot;There was a problem with the requests Content-Type:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#31941" title="List[String]">supported</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; or &quot;)" class="string">&quot; or &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse" class="delimiter">(</span>_: <a href="Rejection.scala.html#9560" title="cc.spray.UnsupportedRequestEncodingRejection">UnsupportedRequestEncodingRejection</a><span class="delimiter">)</span> :: _ =&gt;
        <span class="keyword">val</span> <a title="List[cc.spray.http.HttpEncoding]" id="32020">supported</a> = <a href="#28764" title="List[cc.spray.Rejection]">rejections</a>.<span title="(pf: PartialFunction[cc.spray.Rejection,cc.spray.http.HttpEncoding])(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.Rejection],cc.spray.http.HttpEncoding,List[cc.spray.http.HttpEncoding]])List[cc.spray.http.HttpEncoding]">collect</span> <a href="#32029" title="cc.spray.http.HttpEncoding" class="delimiter">{</a> <span class="keyword">case</span> <span title="cc.spray.http.HttpEncoding">UnsupportedRequestEncodingRejection</span><span class="delimiter">(</span><a title="cc.spray.http.HttpEncoding" id="32052">supported</a><span class="delimiter">)</span> =&gt; <a href="#32052" title="cc.spray.http.HttpEncoding">supported</a> <span class="delimiter">}</span>
        <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <span title="java.lang.String(&quot;The requests Content-Encoding must be one the following:\012&quot;)" class="string">&quot;The requests Content-Encoding must be one the following:\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#32020" title="List[cc.spray.http.HttpEncoding]">supported</a>.<span title="(f: cc.spray.http.HttpEncoding =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[cc.spray.http.HttpEncoding],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#32104" title="cc.spray.http.HttpEncoding">_</a>.<span title="=&gt; String">value</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">ValidationRejection</span><span class="delimiter">(</span><a title="String" id="32166">msg</a><span class="delimiter">)</span> :: _ =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ClientError">BadRequest</span>, <a href="#32166" title="String">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="cc.spray.http.HttpResponse">_</span> =&gt; <span title="(status: cc.spray.http.StatusCode, content: String)cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">(</span><span title="=&gt; cc.spray.http.StatusCodes.ServerError">InternalServerError</span>, <span title="java.lang.String(&quot;Unknown request rejection: &quot;)" class="string">&quot;Unknown request rejection: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#28764" title="List[cc.spray.Rejection]">rejections</a>.<span title="=&gt; cc.spray.Rejection">head</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="[A](response: cc.spray.http.HttpResponse)(f: cc.spray.http.HttpResponse =&gt; A)A" id="27294">withVerifiedResponse</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="27296">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="cc.spray.http.HttpResponse" id="28332">response</a>: <span title="cc.spray.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="cc.spray.http.HttpResponse =&gt; A" id="28333">f</a>: HttpResponse =&gt; A<span class="delimiter">)</span>: <a href="#27296" title="A">A</a> = <span class="delimiter">{</span>
    <a href="#28332" title="cc.spray.http.HttpResponse">response</a>.<span title="=&gt; List[cc.spray.http.HttpHeader]">headers</span>.<span title="(f: cc.spray.http.HttpHeader =&gt; Unit)Unit">foreach</span> <a href="#32213" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Nothing">_</span>: <span title="cc.spray.http.HttpHeaders.Content-Type">`Content-Type`</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="cc.spray.utils.IllegalResponseException" class="keyword">new</span> <span title="cc.spray.utils.IllegalResponseException">IllegalResponseException</span><span class="delimiter">(</span><span class="string">&quot;HttpResponse must not include explicit 'Content-Type' header, &quot;</span> <span title="java.lang.String(&quot;HttpResponse must not include explicit \'Content-Type\' header, use the respective HttpContent member!&quot;)">+</span>
              <span class="string">&quot;use the respective HttpContent member!&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Nothing">_</span>: <span title="cc.spray.http.HttpHeaders.Content-Length">`Content-Length`</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="cc.spray.utils.IllegalResponseException" class="keyword">new</span> <span title="cc.spray.utils.IllegalResponseException">IllegalResponseException</span><span class="delimiter">(</span><span class="string">&quot;HttpResponse must not include explicit 'Content-Length' header, &quot;</span> <span title="java.lang.String(&quot;HttpResponse must not include explicit \'Content-Length\' header, this header will be set implicitly!&quot;)">+</span>
              <span class="string">&quot;this header will be set implicitly!&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>
    <a href="#28333" title="(v1: cc.spray.http.HttpResponse)A">f</a><span class="delimiter">(</span><a href="#28332" title="cc.spray.http.HttpResponse">response</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
<span class="delimiter">}</span>
        </pre>
    </body>
</html>